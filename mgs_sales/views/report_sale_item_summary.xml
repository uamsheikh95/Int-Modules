<?xml version="1.0" encoding="utf-8"?>
<odoo>

  <report
     id="action_sales_by_item_summary"
     name="mgs_sales.sales_by_item_summary_report"
     model="mgs_sales.sales_by_item_summary_report"
     string="Sales by Item Summary"
     report_type="qweb-html"
     paperformat="paperformat_custom"
 />
 <!--  paperformat="paperformat_custom" -->


    <template id="sales_by_item_summary_report">
        <t t-call="web.html_container">
             <t t-call="web.internal_layout" t-lang="en_US">
                <div class="page">
                    <div class="container" style="font-size:12px;font-family:Arial;margin-top:1px;">
                      <div class="text-center" style="margin-top:4px;font-size: 18px; font-weight: bold;">Sales by Item Summary</div>

                      <div id="informations" class="row mt2 mb2">

        								<div class="col-auto mw-100 mb-2" t-if="date_from" name="invoice_date" style="width: 20%; float: left;">
        									<strong>Date from:</strong>
        									<p class="m-0" t-esc="date_from"/>
        								</div>
        								<div class="col-auto mw-100 mb-2" t-if="date_to" name="due_date" style="width: 20%; float: left;">
        									<strong>Date to:</strong>
        									<p class="m-0" t-esc="date_to"/>
        								</div>

                        <div class="col-auto mw-100 mb-2" t-if="product_id" name="due_date" style="width: 20%; float: left;">
        									<strong>product:</strong>
        									<p class="m-0" t-esc="product_name"/>
        								</div>

                        <div class="col-auto mw-100 mb-2" t-if="date_to" name="due_date" style="width: 20%; float: left;">
        									<strong>Company:</strong>
        									<p class="m-0" t-esc="company_name"/>
        								</div>
        							</div>

                      <div class="row">
                        <table style="width:100%;">
                          <thead style="border:1px solid #dadadadd;">
                            <tr style="background-color: #F2F4F4;">
                              <th style="padding-left: 5px;" colspan="4" nowrap="nowrap">Item</th>
                              <th style="text-align:center;padding-right: 5px;" nowrap="nowrap">Qty</th>
                              <th style="text-align:right;padding-right: 5px;" nowrap="nowrap">Sales Price</th>
                              <th style="text-align:right;padding-right: 5px;" nowrap="nowrap">Discount</th>
                              <th style="text-align:right;padding-right: 5px;" nowrap="nowrap">Total</th>
                              <!-- <th>Total</th> -->
                            </tr>
                          </thead>

                          <tbody>
                            <t t-set="total_all_qty" t-value="0"/>
                            <t t-set="total_all_sales_price" t-value="0"/>
                            <t t-set="total_all_discount" t-value="0"/>
                              <t t-set="total_balance" t-value="0"/>

                              <tr style="border:1px solid #dddddd" t-foreach="product_list" t-as="product">
                                <t t-set="total_qty" t-value="0"/>
                                <t t-set="total_sales_price" t-value="0"/>
                                <t t-set="total" t-value="0"/>

                                  <!-- -++++++++++ TOTAL QTY +++++++++++++++++ -->
                                  <!-- <t  t-foreach="qty(product.id, date_from, date_to, company_id)" t-as="q">
                                    <t t-if="q['balance']">
                                      <t t-set="total_qty" t-value="total_qty + q['balance']"/>
                                    </t>
                                  </t> -->

                                  <t t-set="total_qty" t-value="qty(product.id, date_from, date_to, company_id)"/>

                                  <!-- -++++++++++++ TOTAL +++++++++++++++ -->
                                  <!-- <t  t-foreach="balance(product.id, date_from, date_to, company_id)" t-as="bal">
                                    <t t-if="bal['balance']">
                                      <t t-set="total" t-value="total + bal['balance']"/>
                                    </t>
                                  </t> -->

                                  <t t-set="total" t-value="balance(product.id, date_from, date_to, company_id)"/>
                                  <!-- -++++++++++++ TOTAL PRICE UNIT +++++++++++++++ -->
                                  <t t-set="total_sales_price" t-value="total / total_qty" t-if="total_qty"/>



                                  <td colspan="4" style="border: 1px solid #dddddd; padding-left: 5px; width: 80%;"><span t-esc="product.name"/></td>

                                  <td style="border:1px solid #dddddd;text-align:center;padding-left: 5px;">
                                    <span t-esc="'{0:,.2f}'.format(total_qty)" t-esc-options='{"widget": "float", "precision": 5}' />
                                    <t t-set="total_all_qty" t-value="total_all_qty + total_qty"/>
                                  </td>

                                  <td style="border:1px solid #dddddd;text-align:right;padding-left: 5px;">
                                    <span t-esc="'{0:,.4f}'.format(total_sales_price)" />
                                    <t t-set="total_all_sales_price" t-value="total_all_sales_price + total_sales_price"/>
                                  </td>

                                  <td style="border:1px solid #dddddd;text-align:right;padding-left: 5px;">
                                    <span t-esc="'{0:,.2f}'.format(discount(product.id, date_from, date_to, company_id))" />
                                    <t t-set="total_all_discount" t-value="total_all_discount + discount(product.id, date_from, date_to, company_id)"/>
                                  </td>

                                  <td style="border:1px solid #dddddd;text-align:right;padding-left: 5px;">
                                    <span t-esc="'{0:,.2f}'.format(total)" />
                                    <t t-set="total_balance" t-value="total_balance + total" t-if="total"/>
                                  </td>

                                </tr> <!--Product Name-->
                                <tr style="border-bottom:1px solid #dddddd;border-top:1px solid #dddddd;background-color: #F2F4F4;">
                                <td colspan="4"><p style="font-weight:bold;margin-bottom:0;">Total All Balances  : </p></td>
                                <td style="text-align:center;font-weight:bold">
                                  <span t-esc="'{0:,.2f}'.format(total_all_qty)" />

                                </td>

                                <td style="text-align:right;font-weight:bold">
                                  <span t-esc="'{0:,.4f}'.format(total_all_sales_price)" />

                                </td>

                                <td style="text-align:right;font-weight:bold">
                                  <span t-esc="'{0:,.2f}'.format(total_all_discount)" />

                                </td>

                                <td style="text-align:right;font-weight:bold">
                                  <span t-esc="'{0:,.2f}'.format(total_balance)" />

                                </td>
                              </tr>
                          </tbody>
                        </table>
                      </div> <!--tow-->


                    </div> <!--container-->
                </div> <!--page-->
              </t> <!--web.external_layout-->
        </t> <!--web.html_container-->
    </template>
</odoo>
