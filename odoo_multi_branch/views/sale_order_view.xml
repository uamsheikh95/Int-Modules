<?xml version="1.0" encoding="utf-8"?>
<odoo>
		<data>
				<record id="view_order_form_company_branch" model="ir.ui.view">
						<field name="name">sale.order.company.branch</field>
						<field name="model">sale.order</field>
						<field name="inherit_id" ref="sale.view_order_form"/>
						<field name="arch" type="xml">
								<xpath expr="//field[@name='payment_term_id']" position="after">
										<field name="company_branch_id" groups="odoo_multi_branch.group_multi_branches" widget="selection" options="{'no_create': True}"/>
								</xpath>
								<xpath expr="//field[@name='partner_id']" position="replace">
										<field name="partner_id" widget="res_partner_many2one" context="{'search_default_customer':1, 'show_address': 1, 'show_vat': True}" options='{"always_reload": True}'/>
								</xpath>
								<xpath expr="//notebook/page/field[@name='order_line']/tree/field[@name='analytic_tag_ids']" position="before">
										<field name="company_branch_id" invisible="1" widget="selection" options="{'no_create': True}" />
								</xpath>
								<xpath expr="//notebook/page/field[@name='order_line']/form/group/group[2]" position="inside">
										<field name="company_branch_id" invisible="1" widget="selection" options="{'no_create': True}" />
								</xpath>
						</field>
				</record>

				<!-- Add branch field to quotation list view -->
				<record id="view_quotation_list_company_branch" model="ir.ui.view">
						<field name="name">sale.quotation.company.branch</field>
						<field name="model">sale.order</field>
						<field name="inherit_id" ref="sale.view_quotation_tree_with_onboarding"/>
						<field name="arch" type="xml">
							<xpath expr="//field[@name='state']" position="after">
									<field name="company_branch_id" groups="odoo_multi_branch.group_multi_branches" widget="selection" options="{'no_create': True}"/>
							</xpath>
						</field>
				</record>

				<!-- Add branch field to order list view -->
				<record id="view_sale_order_list_company_branch" model="ir.ui.view">
						<field name="name">sale.order.list.company.branch</field>
						<field name="model">sale.order</field>
						<field name="inherit_id" ref="sale.view_order_tree"/>
						<field name="arch" type="xml">
							<xpath expr="//field[@name='state']" position="after">
									<field name="company_branch_id" groups="odoo_multi_branch.group_multi_branches" widget="selection" options="{'no_create': True}"/>
							</xpath>
						</field>
				</record>

				<record id="view_sales_order_filter_inherit_company_branch" model="ir.ui.view">
						<field name="name">sale.order.filter.company.branch</field>
						<field name="model">sale.order</field>
						<field name="inherit_id" ref="sale.view_sales_order_filter"/>
						<field name="arch" type="xml">
								<xpath expr="//search" position="inside">
										 <field name="company_branch_id" groups="odoo_multi_branch.group_multi_branches"/>
								</xpath>
								<xpath expr="//group" position="inside">
										 <filter name="company_branch_id" string="Branch" context="{'group_by':'company_branch_id'}"/>
								</xpath>
						</field>
				</record>
		</data>
</odoo>
